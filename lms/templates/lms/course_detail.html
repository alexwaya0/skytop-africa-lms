{% extends 'lms/base.html' %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow mb-6">
    <h2 class="text-2xl font-bold mb-2">{{ course.title }}</h2>
    <p class="text-gray-600 mb-4">{{ course.description }}</p>
    {% if enrollment %}
        <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="bg-green-500 h-2.5 rounded-full" style="width: {{ enrollment.progress_percentage }}%"></div>
        </div>
        <p class="text-sm text-gray-600 mt-2">Progress: {{ enrollment.progress_percentage }}%</p>
    {% endif %}
</div>
<h3 class="text-xl font-semibold mb-4">Lessons</h3>
<div class="space-y-4">
    {% for lesson in lessons %}
    <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center">
        <div>
            <h4 class="font-medium">{{ lesson.title }}</h4>
            <div class="prose max-w-none">{{ lesson.content|truncatewords:50 }}</div>
            <a href="#" onclick="markComplete({{ lesson.id }})" class="text-skytop-blue underline">View Full & Mark Complete</a>
        </div>
        {% if lesson.id in completed_ids %}
            <span class="bg-green-200 text-green-800 px-2 py-1 rounded text-sm">Completed</span>
        {% endif %}
    </div>
    {% endfor %}
</div>

<script>
function markComplete(lessonId) {
    fetch(`/complete-lesson/${lessonId}/`, {method: 'POST', headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}})
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();  // Refresh to update progress
        }
    });
}
</script>
{% endblock %}